<!-- èƒŒæ™¯å›¾ç‰‡ -->
{{ partial "footer/background-image.html" . }}

<!-- ä¸‰ä¸ªæ¿å—æ ·å¼ -->
{{ partial "footer/section-styles.html" . }}

<!-- å­—ä½“é¢œè‰²ä¼˜åŒ– -->
{{ partial "footer/font-colors.html" . }}

<!-- éŸ³ä¹æ’­æ”¾å™¨ï¼ˆç§»åˆ°å¯æ‰©å±•æ§åˆ¶æŒ‰é’®å®¹å™¨å¤–éƒ¨ï¼‰ -->
{{ partial "footer/music-player.html" . }}

<!-- å¯æ‰©å±•æ§åˆ¶æŒ‰é’®å®¹å™¨ -->
<div class="expandable-controls-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 99999; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
  <div class="controls-wrapper" style="display: flex; align-items: center; gap: 12px; background: linear-gradient(135deg, rgba(255, 200, 210, 0.8), rgba(170, 210, 230, 0.8)); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 50px; padding: 8px; box-shadow: 0 4px 16px rgba(170, 210, 230, 0.4); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); width: 50px; height: 50px; overflow: hidden; flex-direction: row-reverse;">
    <!-- å±•å¼€/æ”¶èµ·ç®­å¤´ -->
    <button id="expand-toggle" class="expand-toggle" aria-label="å±•å¼€/æ”¶èµ·æ§åˆ¶æŒ‰é’®" title="å±•å¼€/æ”¶èµ·æ§åˆ¶æŒ‰é’®" style="width: 34px; height: 34px; background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #333; transition: all 0.3s ease; flex-shrink: 0;">
      <span class="expand-arrow" style="display: block; transition: transform 0.3s ease;">â˜°</span>
    </button>
    
    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="control-buttons" style="display: flex; gap: 16px; transition: all 0.3s ease; transform: translateX(-20px); opacity: 0; pointer-events: none;">
      <!-- éŸ³ä¹æ’­æ”¾å™¨æ§åˆ¶æŒ‰é’® -->
      <button id="music-player-toggle" class="music-player-toggle control-button" aria-label="éŸ³ä¹æ’­æ”¾å™¨" title="éŸ³ä¹æ’­æ”¾å™¨" style="width: 34px; height: 34px; background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #333; transition: all 0.3s ease;">
        <span class="toggle-icon play-icon" style="display: block; transition: all 0.3s ease;">â™ª</span>
        <span class="toggle-icon close-icon" style="display: none; transition: all 0.3s ease; font-size: 16px; font-weight: bold;">Ã—</span>
      </button>
      
      <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
      {{ partial "footer/theme-toggle.html" . }}
      
      <!-- é€æ˜åº¦è°ƒèŠ‚æŒ‰é’® -->
      <button id="transparency-toggle" class="transparency-toggle control-button" aria-label="é€æ˜åº¦è°ƒèŠ‚" title="é€æ˜åº¦è°ƒèŠ‚" style="width: 34px; height: 34px; background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #333; transition: all 0.3s ease;">
        <span class="transparency-icon" style="display: block; transition: all 0.3s ease;">ğŸ‘</span>
      </button>
      
      <!-- æ²‰æµ¸é˜…è¯»æŒ‰é’® -->
      <button id="immersive-reading-button" class="immersive-reading-button control-button" aria-label="æ²‰æµ¸é˜…è¯»" title="æ²‰æµ¸é˜…è¯»" style="width: 34px; height: 34px; background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: #333; transition: all 0.3s ease;">
        <span class="immersive-icon book-icon" style="display: block; transition: all 0.3s ease;">ğŸ“–</span>
        <span class="immersive-icon exit-icon" style="display: none; transition: all 0.3s ease;">Ã—</span>
      </button>
    </div>
    
    <!-- é€æ˜åº¦è°ƒèŠ‚é¢æ¿ -->
    <div id="transparency-panel" class="transparency-panel" style="position: absolute; bottom: 70px; right: 0; width: 200px; background: linear-gradient(135deg, rgba(255, 200, 210, 0.9), rgba(170, 210, 230, 0.9)); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 12px; padding: 16px; box-shadow: 0 8px 32px rgba(170, 210, 230, 0.4); z-index: 99999; transform: translateX(100%); opacity: 0; pointer-events: none; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);">
      <h4 style="margin: 0 0 12px 0; font-size: 14px; font-weight: 600; color: #333; text-align: center;">é€æ˜åº¦è°ƒèŠ‚</h4>
      <div class="transparency-slider-container" style="display: flex; flex-direction: column; gap: 8px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <span style="font-size: 12px; color: #333;">é€æ˜</span>
          <span style="font-size: 12px; color: #333;">ä¸é€æ˜</span>
        </div>
        <input type="range" id="transparency-slider" class="transparency-slider" min="0" max="100" value="100" style="width: 100%; height: 8px; border-radius: 4px; background: rgba(255, 255, 255, 0.5); outline: none; -webkit-appearance: none; appearance: none; transition: all 0.3s ease;">
        <div style="text-align: center;">
          <span id="transparency-value" style="font-size: 12px; color: #333; font-weight: 600;">100%</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// å±•å¼€/æ”¶èµ·æ§åˆ¶è„šæœ¬
document.addEventListener('DOMContentLoaded', function() {
  const expandToggle = document.getElementById('expand-toggle');
  const controlButtons = document.querySelector('.control-buttons');
  const expandArrow = document.querySelector('.expand-arrow');
  const controlsWrapper = document.querySelector('.controls-wrapper');
  
  let isExpanded = false;
  
  expandToggle.addEventListener('click', function() {
    isExpanded = !isExpanded;
    
    if (isExpanded) {
      // å±•å¼€çŠ¶æ€
      expandArrow.textContent = 'âœ•';
      controlsWrapper.style.width = 'auto';
      controlsWrapper.style.minWidth = '180px';
      controlsWrapper.style.borderRadius = '25px';
      controlButtons.style.transform = 'translateX(0)';
      controlButtons.style.opacity = '1';
      controlButtons.style.pointerEvents = 'auto';
    } else {
      // æ”¶èµ·çŠ¶æ€
      expandArrow.textContent = 'â˜°';
      controlsWrapper.style.width = '50px';
      controlsWrapper.style.minWidth = '50px';
      controlsWrapper.style.borderRadius = '50px';
      controlButtons.style.transform = 'translateX(-20px)';
      controlButtons.style.opacity = '0';
      controlButtons.style.pointerEvents = 'none';
    }
  });

  // åˆå§‹çŠ¶æ€ï¼šæ”¶èµ·ï¼ˆåœ†å½¢ï¼‰
  isExpanded = false;
  expandArrow.textContent = 'â˜°';
  controlsWrapper.style.width = '50px';
  controlsWrapper.style.minWidth = '50px';
  controlsWrapper.style.borderRadius = '50px';
  controlButtons.style.transform = 'translateX(-20px)';
  controlButtons.style.opacity = '0';
  controlButtons.style.pointerEvents = 'none';
});

// é€æ˜åº¦è°ƒèŠ‚åŠŸèƒ½
function initTransparencyControl() {
  const transparencyToggle = document.getElementById('transparency-toggle');
  const transparencyPanel = document.getElementById('transparency-panel');
  const transparencySlider = document.getElementById('transparency-slider');
  const transparencyValue = document.getElementById('transparency-value');
  
  if (!transparencyToggle || !transparencyPanel || !transparencySlider || !transparencyValue) {
    console.warn('é€æ˜åº¦è°ƒèŠ‚å…ƒç´ ä¸å­˜åœ¨');
    return;
  }
  
  let isPanelVisible = false;
  
  // ç‚¹å‡»é€æ˜åº¦æŒ‰é’®
  transparencyToggle.addEventListener('click', function() {
    isPanelVisible = !isPanelVisible;
    
    if (isPanelVisible) {
      transparencyPanel.style.transform = 'translateX(0%)';
      transparencyPanel.style.opacity = '1';
      transparencyPanel.style.pointerEvents = 'auto';
    } else {
      transparencyPanel.style.transform = 'translateX(100%)';
      transparencyPanel.style.opacity = '0';
      transparencyPanel.style.pointerEvents = 'none';
    }
  });
  
  // æ»‘å—å˜åŒ–
  transparencySlider.addEventListener('input', function() {
    const value = parseInt(this.value);
    const opacity = value / 100;
    
    // åº”ç”¨é€æ˜åº¦åˆ°ä¸»å†…å®¹åŒºåŸŸ
    const mainContent = document.querySelector('.main');
    const sidebarRight = document.querySelector('.sidebar.right-sidebar');
    
    if (mainContent) {
      mainContent.style.opacity = opacity;
    }
    if (sidebarRight) {
      sidebarRight.style.opacity = opacity;
    }
    
    // æ›´æ–°æ˜¾ç¤ºå€¼
    transparencyValue.textContent = value + '%';
  });
  
  // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­é¢æ¿
  document.addEventListener('click', function(event) {
    if (!transparencyPanel.contains(event.target) && !transparencyToggle.contains(event.target)) {
      transparencyPanel.style.transform = 'translateX(100%)';
      transparencyPanel.style.opacity = '0';
      transparencyPanel.style.pointerEvents = 'none';
      isPanelVisible = false;
    }
  });
}

// æ²‰æµ¸é˜…è¯»åŠŸèƒ½
function initImmersiveReading() {
  const immersiveButton = document.getElementById('immersive-reading-button');
  const body = document.body;
  const sidebarLeft = document.querySelector('.sidebar.left-sidebar');
  const sidebarRight = document.querySelector('.sidebar.right-sidebar');
  const mainContent = document.querySelector('.main');
  const container = document.querySelector('.container.main-container');
  
  if (!immersiveButton) return;
  
  immersiveButton.addEventListener('click', function() {
    const isImmersive = body.classList.contains('immersive-reading');
    
    if (isImmersive) {
      // é€€å‡ºæ²‰æµ¸é˜…è¯»
      body.classList.remove('immersive-reading');
      
      if (sidebarLeft) sidebarLeft.style.display = '';
      if (sidebarRight) sidebarRight.style.display = 'none';
      if (mainContent) {
        mainContent.style.width = '';
        mainContent.style.maxWidth = '';
        mainContent.style.margin = '';
      }
      if (container) {
        container.classList.remove('extended');
        container.classList.add('compact');
      }
      
      // åˆ‡æ¢å›¾æ ‡
      const bookIcon = immersiveButton.querySelector('.book-icon');
      const exitIcon = immersiveButton.querySelector('.exit-icon');
      if (bookIcon) bookIcon.style.display = 'block';
      if (exitIcon) exitIcon.style.display = 'none';
    } else {
      // è¿›å…¥æ²‰æµ¸é˜…è¯»
      body.classList.add('immersive-reading');
      
      if (sidebarLeft) sidebarLeft.style.display = 'none';
      if (sidebarRight) sidebarRight.style.display = 'none';
      if (mainContent) {
        mainContent.style.width = '100%';
        mainContent.style.maxWidth = '100%';
        mainContent.style.margin = '0';
      }
      if (container) {
        container.style.display = 'block';
        container.style.maxWidth = '100%';
        container.style.width = '100%';
      }
      
      // åˆ‡æ¢å›¾æ ‡
      const bookIcon = immersiveButton.querySelector('.book-icon');
      const exitIcon = immersiveButton.querySelector('.exit-icon');
      if (bookIcon) bookIcon.style.display = 'none';
      if (exitIcon) exitIcon.style.display = 'block';
    }
  });
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('load', function() {
  initTransparencyControl();
  initImmersiveReading();
});
</script>