{{- /* 增强版Meta标签生成 */ -}}
{{- $title := partial "data/title" . -}}
{{- $description := partial "data/description" . -}}
{{- $image := partial "helper/image" (dict "Context" . "Type" "article") -}}
{{- $url := .Permalink -}}
{{- $type := .Type -}}
{{- $section := .Section -}}
{{- $tags := .Params.tags -}}

{{- /* 基础Meta标签 */ -}}
{{- $metaTags := slice -}}

{{- /* 标题标签 */ -}}
{{- $metaTags = $metaTags | append (printf "<title>%s</title>" $title) -}}

{{- /* 描述标签 */ -}}
{{- if $description -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"description\" content=\"%s\">" $description) -}}
{{- end -}}

{{- /* 关键词标签 */ -}}
{{- if $tags -}}
    {{- $keywords := delimit $tags ", " -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"keywords\" content=\"%s\">" $keywords) -}}
{{- else if .Site.Params.keywords -}}
    {{- $keywords := delimit .Site.Params.keywords ", " -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"keywords\" content=\"%s\">" $keywords) -}}
{{- end -}}

{{- /* 作者标签 */ -}}
{{- if .Params.author -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"author\" content=\"%s\">" .Params.author) -}}
{{- else if .Site.Params.author -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"author\" content=\"%s\">" .Site.Params.author) -}}
{{- end -}}

{{- /* Open Graph标签 */ -}}
{{- $metaTags = $metaTags | append (printf "<meta property=\"og:title\" content=\"%s\">" $title) -}}
{{- if $description -}}
    {{- $metaTags = $metaTags | append (printf "<meta property=\"og:description\" content=\"%s\">" $description) -}}
{{- end -}}
{{- $metaTags = $metaTags | append (printf "<meta property=\"og:url\" content=\"%s\">" $url) -}}

{{- /* Open Graph类型 */ -}}
{{- if .IsHome -}}
    {{- $metaTags = $metaTags | append "<meta property=\"og:type\" content=\"website\">" -}}
{{- else if .IsPage -}}
    {{- $metaTags = $metaTags | append "<meta property=\"og:type\" content=\"article\">" -}}
    {{- /* 文章发布时间 */ -}}
    {{- if .Date -}}
        {{- $metaTags = $metaTags | append (printf "<meta property=\"article:published_time\" content=\"%s\">" (.Date.Format "2006-01-02T15:04:05Z07:00")) -}}
    {{- end -}}
    {{- /* 文章更新时间 */ -}}
    {{- if .Lastmod -}}
        {{- $metaTags = $metaTags | append (printf "<meta property=\"article:modified_time\" content=\"%s\">" (.Lastmod.Format "2006-01-02T15:04:05Z07:00")) -}}
    {{- end -}}
    {{- /* 文章标签 */ -}}
    {{- if $tags -}}
        {{- range $tags -}}
            {{- $metaTags = $metaTags | append (printf "<meta property=\"article:tag\" content=\"%s\">" .) -}}
        {{- end -}}
    {{- end -}}
{{- else -}}
    {{- $metaTags = $metaTags | append "<meta property=\"og:type\" content=\"website\">" -}}
{{- end -}}

{{- /* Open Graph图片 */ -}}
{{- if $image.exists -}}
    {{- $imageUrl := $image.resource.RelPermalink | default $image.permalink -}}
    {{- $metaTags = $metaTags | append (printf "<meta property=\"og:image\" content=\"%s\">" $imageUrl) -}}
    {{- if $image.resource -}}
        {{- $metaTags = $metaTags | append (printf "<meta property=\"og:image:width\" content=\"%d\">" $image.resource.Width) -}}
        {{- $metaTags = $metaTags | append (printf "<meta property=\"og:image:height\" content=\"%d\">" $image.resource.Height) -}}
    {{- end -}}
    {{- $metaTags = $metaTags | append (printf "<meta property=\"og:image:alt\" content=\"%s\">" .Title) -}}
{{- else if .Site.Params.images -}}
    {{- $siteImage := index .Site.Params.images 0 -}}
    {{- $metaTags = $metaTags | append (printf "<meta property=\"og:image\" content=\"%s\">" $siteImage) -}}
{{- end -}}

{{- /* Open Graph站点名称 */ -}}
{{- if .Site.Title -}}
    {{- $metaTags = $metaTags | append (printf "<meta property=\"og:site_name\" content=\"%s\">" .Site.Title) -}}
{{- end -}}

{{- /* Twitter Cards标签 */ -}}
{{- $twitterCard := .Site.Params.twitter.card | default "summary_large_image" -}}
{{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:card\" content=\"%s\">" $twitterCard) -}}
{{- if .Site.Params.twitter.site -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:site\" content=\"%s\">" .Site.Params.twitter.site) -}}
{{- end -}}
{{- if .Site.Params.twitter.creator -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:creator\" content=\"%s\">" .Site.Params.twitter.creator) -}}
{{- end -}}
{{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:title\" content=\"%s\">" $title) -}}
{{- if $description -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:description\" content=\"%s\">" $description) -}}
{{- end -}}
{{- if $image.exists -}}
    {{- $imageUrl := $image.resource.RelPermalink | default $image.permalink -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:image\" content=\"%s\">" $imageUrl) -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:image:alt\" content=\"%s\">" .Title) -}}
{{- else if .Site.Params.images -}}
    {{- $siteImage := index .Site.Params.images 0 -}}
    {{- $metaTags = $metaTags | append (printf "<meta name=\"twitter:image\" content=\"%s\">" $siteImage) -}}
{{- end -}}

{{- /* 规范URL标签 */ -}}
{{- if .IsPage -}}
    {{- $metaTags = $metaTags | append (printf "<link rel=\"canonical\" href=\"%s\">" .Permalink) -}}
{{- end -}}

{{- /* 输出所有Meta标签 */ -}}
{{- return delimit $metaTags "\n" -}}